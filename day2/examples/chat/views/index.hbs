<section class="container">
  <h1 class="center">Socket.IO Examples</h1>
  
  <div class="row">
    <div class="col-md-6 box">
      <h2>Understanding WebSockets</h2>
      <p>The internet first began as a trove of information made easily accessible by a collection of HTML pages. This mechanism for information dissemination was just a bunch of static assets, not meant to be dynamic. But thanks to Microsoft the web was introduced to XMLHttpRequest and AJAX. Though this allowed webpages to become more dynamic, it didn't allow for true bi-directional communication between the client and the server. That's what WebSockets come in. Polling and Long Polling often leads to high network traffic and latency issues, but implementing WebSockets solves this problem by eradicating polling altogether. The WebSocket interface opens a communication channel between the client and server via a socket connection on the web, and both the client and server can send data at any time.</p>
      
      <h2>What is Socket.IO?</h2>
      <p>Socket.io is a library that allows for realtime, bi-directional communication between the client and server. It uses feature detection to figure out if the connection will be established via WebSockets, Long Polling, Flash, etc, though it primarily uses the WebSocket protocol.</p>
      
      <h2>Instructions</h2>
      <p>Follow the Socket.IO examples instructions at <a href="https://github.com/horizons-school-of-technology/week05/tree/master/day2/examples/README.md">https://github.com/horizons-school-of-technology/week05/tree/master/day2/examples/README.md</a></p>
      <input id="username" class="inline typebox" type="text" placeholder="Enter username...">
      <button id="send-username" class="inline submitbutton">Send</button>
      <div class="users">
        <h4>Users</h4>
        <ul id="users-list"></ul>
      </div>
    </div>
    <div class="col-md-6 box">
    <button id="room1-button" class="submitbutton">Room 1</button>
    <button id="room2-button" class="submitbutton">Room 2</button>
    <div class="textbox" style="background-color: blue;">
    </div>
    <div class="inputbox block">
      <input id="message" class="inline typebox" type="text" placeholder="Say Something...">
      <button id="send" class="inline submitbutton">Send</button>
    </div>
    <div class="warning"></div>
  </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
<script>
$(document).ready(function() {

  $('#room2').hide();
  var socket = io();

  var room = "room1";

  // Initial socket connection
  socket.on('connect', function() {
    socket.emit('room', room);
    console.log('Client connected!')
  })

  // Toggling rooms
  $('#room1-button').on('click', function() {
    room = "room1";
    $('.textbox').empty();
    $('.textbox').css({'background-color' : 'green'});
    socket.emit('room', room);
  })

  $('#room2-button').on('click', function() {
    room = "room2";
    $('.textbox').empty();
    $('.textbox').css({'background-color' : 'blue'});
    socket.emit('room', room);
  })

  // Handling button presses, emitting to server
  $('#send').on('click', function() {
    var msg = $('#message').val();
    socket.emit('newMessage', msg);
  })

  $('#send-username').on('click', function() {
    var username = $('#username').val();
    socket.emit('newUsername', username);
  })

  // Handling server emmitted events on the client side

  socket.on('serverMessage', function(serverMsg) {
    console.log('Recieving message: ' + serverMsg)
    $('.textbox').append(`<div style="margin: 20px 5px; padding: 10px; background-color: white; border: 1px solid black;">${serverMsg}</div>`);
  });

  socket.on('welcomeUser', function(username) {
    console.log("Welome user")
    $('.warning').append(`<div style="margin: 20px 5px; padding: 10px; background-color: green; color: white; border: 1px solid black;">Welcome to the chatroom, ${username}!</div>`);
  })

  socket.on('serverUsername', function(serverUsername) {
    console.log('Recieving username: ' + serverUsername)
    $('#users-list').append(`<li>${serverUsername}</div>`);
    $('.warning').empty();
  });

  socket.on('warningMessage', function(warning) {
    console.log('Recieving warning')
    $('.warning').append(`<div style="margin: 20px 5px; padding: 10px; background-color: red; color: white; border: 1px solid black;">${warning}</div>`);
  });

  socket.on('joinedRoom', function(username) {
    console.log(username + ' has joined the room!');
    $('.textbox').append(`<div style="margin: 20px 5px; padding: 10px; background-color: blue; color: white; border: 1px solid black;">${username} has joined the room!</div>`);
  })
})


</script>




